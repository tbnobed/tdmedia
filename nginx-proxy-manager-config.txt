# Nginx Proxy Manager Configuration for Trilogy Digital Media

# This file provides recommended settings for your Nginx Proxy Manager
# Copy these settings to the "Advanced" tab in your proxy host configuration

# Client Max Body Size - Increase to allow large file uploads (1GB)
client_max_body_size 1000m;

# Proxy Buffer Settings - Optimize for large file transfers
proxy_buffer_size 16k;
proxy_buffers 8 16k;
proxy_busy_buffers_size 32k;

# Timeouts - Increase for large file uploads
proxy_connect_timeout 300s;
proxy_send_timeout 300s;
proxy_read_timeout 300s;

# Cache Settings for Media Files
location ~* \.(jpg|jpeg|png|gif|ico|css|js|svg)$ {
    proxy_pass http://app:5000;
    expires 7d;
    add_header Cache-Control "public, max-age=604800, immutable";
}

# Media file streaming with special handling
location /uploads/ {
    proxy_pass http://app:5000;
    add_header Cache-Control "public, max-age=86400";
    add_header Content-Disposition "inline";
    
    # Video streaming optimizations
    proxy_http_version 1.1;
    proxy_set_header Connection "";
    proxy_set_header Range $http_range;
    proxy_set_header If-Range $http_if_range;
    proxy_cache_valid 200 206 1d;
    proxy_buffering off;
}

# Pass all other requests normally
location / {
    proxy_pass http://app:5000;
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    proxy_set_header Host $host;
    proxy_cache_bypass $http_upgrade;
}